(this["webpackJsonpdot-layout"]=this["webpackJsonpdot-layout"]||[]).push([[0],{10:function(e,t,n){},11:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);n(10),n(11);var r=n(4),o=n(1),a=n(0),c=n.n(a),u=n(7),l=n.n(u),i=1,s="state";function d(e){var t=function(e){var t={version:i,data:e};return JSON.stringify(t)}(e);localStorage.setItem(s,t)}function f(){return function(e){try{if(null===e)return null;var t=JSON.parse(e);return null==(n=t)||"object"!==typeof n||n.version!==i?null:t.data}catch(r){return null}var n}(localStorage.getItem(s))}var E=n(2),b=n.n(E),y=function(e){var t=e.className,n=e.children,r=e.disabled,o=e.onClick;return c.a.createElement("button",{className:b()("Button",t),disabled:r,onClick:o},n)},v=function(e){var t=e.onAdd,n=e.onRemove,r=e.onClear,o=e.onRandomize,a=e.onSave,u=e.canRemove;return c.a.createElement("div",{className:"ControlPanel"},c.a.createElement(y,{className:"ControlPanel__button",onClick:t},"Add (A)"),c.a.createElement(y,{className:"ControlPanel__button",onClick:n,disabled:!u},"Remove (Del)"),c.a.createElement(y,{className:"ControlPanel__button",onClick:r},"Clear"),c.a.createElement(y,{className:"ControlPanel__button",onClick:o},"Randomize"),c.a.createElement(y,{className:"ControlPanel__button",onClick:a},"Save (Cmd+S)"))},O=function(e){var t=e.edge,n=e.startNode,r=e.endNode,o=e.selected,u=e.onClick,l=Object(a.useMemo)((function(){return function(e,t){var n=t.x-e.x,r=t.y-e.y,o=Math.sqrt(n*n+r*r);return{x:n/=o,y:r/=o}}(n,r)}),[n,r]),i=Object(a.useCallback)((function(e){e.stopPropagation(),u(t,e)}),[t,u]);return c.a.createElement(c.a.Fragment,null,c.a.createElement("line",{className:b()("EdgeView",{"EdgeView--selected":o}),x1:n.x+36*l.x,y1:n.y+36*l.y,x2:r.x-36*l.x,y2:r.y-36*l.y,markerEnd:"url(#arrow)",onClick:i}))};var m,p,h=function(e){var t=e.node,n=e.selected,r=e.onClick,u=e.onDoubleClick,l=e.onMouseDown,i=e.onMouseMove,s=e.onMouseUp,d=Object(a.useState)(null),f=Object(o.a)(d,2),E=f[0],y=f[1],v=Object(a.useCallback)((function(e){var n={x:e.clientX,y:e.clientY};y(n),l({node:t,start:n,current:n},e)}),[l,t]),O=Object(a.useCallback)((function(e){if(null!==E){var n={x:e.clientX,y:e.clientY},r={node:t,start:E,current:n};y(null),s(r)}}),[s,t,E]),m=Object(a.useCallback)((function(e){if(null!==E){var n={x:e.clientX,y:e.clientY};i({node:t,start:E,current:n})}}),[i,t,E]);Object(a.useEffect)((function(){return document.body.addEventListener("mouseup",O),function(){document.body.removeEventListener("mouseup",O)}}),[O]),Object(a.useEffect)((function(){if(null!==E)return document.body.addEventListener("mousemove",m),function(){document.body.removeEventListener("mousemove",m)}}),[m,E]);var p=Object(a.useCallback)((function(e){e.stopPropagation(),r(t,e)}),[r,t]),h=Object(a.useCallback)((function(e){e.stopPropagation(),u(t,e)}),[u,t]);return c.a.createElement(c.a.Fragment,null,c.a.createElement("circle",{className:b()("NodeView",{"NodeView--selected":n,dragging:E}),cx:t.x,cy:t.y,r:36,onClick:p,onDoubleClick:h,onMouseDown:v}),c.a.createElement(g,{x:t.x,y:t.y,text:t.text}))},g=function(e){var t=e.x,n=e.y,r=e.text;return c.a.createElement("foreignObject",{className:"NodeView__text",x:t-36,y:n-36,width:72,height:72},c.a.createElement("p",{className:"NodeView__text-inner"},r))},C=function(e){var t=e.children,n=e.stage;return c.a.createElement("svg",{className:"Stage",width:n.width,height:n.height,viewBox:"0 0 ".concat(n.width," ").concat(n.height)},c.a.createElement("defs",null,D,P),t)},D=c.a.createElement("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse"},c.a.createElement("path",{d:"M 0 0 L 10 5 L 0 10 z"})),P=c.a.createElement("marker",{id:"dot",viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"5",markerHeight:"5"},c.a.createElement("circle",{cx:"5",cy:"5",r:"5",fill:"red"}));function A(e){var t=e.dispatch,n=e.onAdd,r=e.onSave;!function(e){var t=e.onKeyDown;Object(a.useEffect)((function(){var e=document.body;function n(n){n.target===e&&t(n)}return e.addEventListener("keydown",n),function(){e.removeEventListener("keydown",n)}}),[t])}({onKeyDown:Object(a.useCallback)((function(e){if(e.code===m.KEY_A)n();else if(e.code===m.BACKSPACE)t({type:p.GRAPH_REMOVE});else if(e.code===m.ESCAPE)t({type:p.GRAPH_DESELECT});else{if(!e.ctrlKey&&!e.metaKey||e.code!==m.KEY_S)return;r()}e.preventDefault()}),[t,n,r])})}!function(e){e.BACKSPACE="Backspace",e.ENTER="Enter",e.ESCAPE="Escape",e.KEY_A="KeyA",e.KEY_D="KeyD",e.KEY_R="KeyR",e.KEY_S="KeyS",e.KEY_W="KeyW"}(m||(m={})),function(e){e[e.APP_LOAD=0]="APP_LOAD",e[e.APP_RANDOMIZE=1]="APP_RANDOMIZE",e[e.GRAPH_CLEAR=2]="GRAPH_CLEAR",e[e.NODE_ADD=3]="NODE_ADD",e[e.GRAPH_REMOVE=4]="GRAPH_REMOVE",e[e.NODE_UPDATE=5]="NODE_UPDATE",e[e.GRAPH_SELECT=6]="GRAPH_SELECT",e[e.GRAPH_DESELECT=7]="GRAPH_DESELECT",e[e.EDGE_ADD=8]="EDGE_ADD"}(p||(p={}));var j=400;function _(e){var t=Object(a.useRef)(e);Object(a.useEffect)((function(){t.current=e}),[t,e]),Object(a.useEffect)((function(){var e=function(e,t){var n=null;function r(){null!==n&&(clearTimeout(n),n=null)}return function(){return r(),n=setTimeout((function(){e()}),t),r}}((function(){t.current()}),j);return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[t])}var x=n(5),k=n(8);function w(){return Object(k.generate)()}function R(e){return Math.floor(Math.random()*e)}function N(e){return function(e){for(var t=[],n=0;n<e;n+=1)t.push(n);return t}(5).map((function(){return function(e){return{id:w(),x:R(e.width),y:R(e.height),text:"sample"}}(e)}))}function S(e,t){var n=function e(t,n){if(0===n.length)return t;var r=t.w/2;var o=t.h/2;var a=t.x+r;var c=t.y+o;var u={box:{x:t.x,y:t.y,w:r,h:o},nodes:[]};var l={box:{x:a,y:t.y,w:r,h:o},nodes:[]};var i={box:{x:t.x,y:c,w:r,h:o},nodes:[]};var s={box:{x:a,y:c,w:r,h:o},nodes:[]};for(var d=0;d<n.length;d+=1){var f=n[d];f.x<=a?f.y<=c?u.nodes.push(f):i.nodes.push(f):f.y<=c?l.nodes.push(f):s.nodes.push(f)}var E=(b=[u,l,i,s],b.slice(0).sort((function(e,t){return e.nodes.length-t.nodes.length}))[0]);var b;return function(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}(n,E.nodes)?E.box:e(E.box,E.nodes)}({x:0,y:0,w:t.width,h:t.height},e);return{id:w(),x:n.x+n.w/2,y:n.y+n.h/2,text:""}}function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(n,!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G={nodes:[],edges:[],selectedId:null};function H(e,t){switch(t.type){case p.APP_LOAD:return t.payload.state;case p.APP_RANDOMIZE:return{nodes:N(t.payload.stage),edges:[],selectedId:null};case p.GRAPH_CLEAR:return L({},e,{nodes:[],edges:[],selectedId:null});case p.GRAPH_REMOVE:var n=e.nodes.filter((function(t){return t.id!==e.selectedId})),r=e.edges.filter((function(t){return t.id!==e.selectedId&&t.start!==e.selectedId&&t.end!==e.selectedId}));return L({},e,{nodes:n,edges:r});case p.GRAPH_SELECT:var o=t.payload.id;return L({},e,{selectedId:o});case p.GRAPH_DESELECT:return L({},e,{selectedId:null});case p.NODE_ADD:var a=t.payload.stage,c=S(e.nodes,a);return L({},e,{nodes:[].concat(Object(x.a)(e.nodes),[c])});case p.NODE_UPDATE:var u=t.payload.node;return L({},e,{nodes:K(e.nodes,u)});case p.EDGE_ADD:var l=t.payload,i=l.start,s=l.end;if(null===i||i===s||!T(e.nodes,i)||!T(e.nodes,s)||(f=e.edges,E=i,b=s,f.find((function(e){return e.start===E&&e.end===b||e.start===b&&e.end===E}))))return e;var d={id:w(),start:i,end:s};return L({},e,{edges:[].concat(Object(x.a)(e.edges),[d])});default:return e}var f,E,b}function K(e,t){return e.map((function(e){return e.id===t.id?t:e}))}function T(e,t){return!!e.find((function(e){return e.id===t}))}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(n,!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=function(){},B={width:1,height:1};var U=document.getElementById("root");l.a.render(c.a.createElement((function(){var e=Object(a.useRef)(null),t=Object(a.useState)(B),n=Object(o.a)(t,2),r=n[0],u=n[1],l=Object(a.useState)(null),i=Object(o.a)(l,2),s=i[0],E=i[1],b=Object(a.useState)(!1),y=Object(o.a)(b,2),m=y[0],g=y[1],D=Object(a.useReducer)(H,G),P=Object(o.a)(D,2),j=P[0],x=P[1],k=j.nodes,w=j.edges,R=j.selectedId,N=Object(a.useMemo)((function(){return function(e){var t={};return e.forEach((function(e){t[e.id]=e})),t}(k)}),[k]),S=Object(a.useCallback)((function(){x({type:p.GRAPH_CLEAR})}),[]),M=Object(a.useCallback)((function(){x({type:p.NODE_ADD,payload:{stage:r}})}),[r]),L=Object(a.useCallback)((function(e,t){t.ctrlKey||t.metaKey?x({type:p.EDGE_ADD,payload:{start:R,end:e.id}}):x({type:p.GRAPH_SELECT,payload:{id:e.id}})}),[R]),K=Object(a.useCallback)((function(e){x({type:p.GRAPH_SELECT,payload:{id:e.id}})}),[]),T=Object(a.useCallback)((function(e){var t=prompt("text",e.text);if(null!==t){var n=Y({},e,{text:t});x({type:p.NODE_UPDATE,payload:{node:n}})}}),[]),I=Object(a.useCallback)((function(){x({type:p.GRAPH_DESELECT})}),[]),U=Object(a.useCallback)((function(){x({type:p.GRAPH_REMOVE})}),[]),z=Object(a.useCallback)((function(e){var t=e.node;E(t)}),[]),X=Object(a.useCallback)((function(e){null!==s&&(x({type:p.NODE_UPDATE,payload:{node:s}}),E(null),g(!1))}),[s]),J=Object(a.useCallback)((function(e){if(null!==s){var t=function(e){var t=e.node,n=e.start,r=e.current,o=r.x-n.x,a=r.y-n.y;return Y({},t,{x:Math.floor(t.x+o),y:Math.floor(t.y+a)})}(e);n=t,r=e.node,(n.id!==r.id||n.x!==r.x||n.y!==r.y)&&(E(t),g(!0))}var n,r}),[s]),W=Object(a.useCallback)((function(){d(j)}),[j]),Z=Object(a.useCallback)((function(){x({type:p.APP_RANDOMIZE,payload:{stage:r}})}),[r]),F=Object(a.useCallback)((function(){if(null!==e.current){var t=e.current.getBoundingClientRect(),n=t.width,r=t.height;u({width:n,height:r})}}),[e]);return Object(a.useEffect)((function(){var e=f();null!==e&&x({type:p.APP_LOAD,payload:{state:e}})}),[]),_(F),Object(a.useEffect)(F,[]),A({dispatch:x,onAdd:M,onSave:W}),c.a.createElement("div",{className:"App",onClick:I},c.a.createElement(v,{onAdd:M,onRemove:U,onClear:S,onRandomize:Z,onSave:W,canRemove:null!==R}),c.a.createElement("div",{className:"StageContainer",ref:e},c.a.createElement(C,{stage:r},w.map((function(e){return c.a.createElement(O,{key:e.id,edge:e,startNode:N[e.start],endNode:N[e.end],selected:R===e.id,onClick:K})})),k.map((function(e){return c.a.createElement(h,{key:e.id,node:e,selected:R===e.id,onClick:L,onDoubleClick:T,onMouseDown:z,onMouseUp:X,onMouseMove:J})})),m&&null!==s&&c.a.createElement(h,{key:s.id,node:s,selected:!1,onClick:V,onDoubleClick:V,onMouseDown:V,onMouseUp:V,onMouseMove:V}))))}),null),U)},9:function(e,t,n){e.exports=n(24)}},[[9,1,2]]]);
//# sourceMappingURL=main.36cdd924.chunk.js.map