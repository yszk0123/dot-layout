(this["webpackJsonpdot-layout"]=this["webpackJsonpdot-layout"]||[]).push([[0],{10:function(e,t,n){},11:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);n(10),n(11);var r=n(4),o=n(2),a=n(0),c=n.n(a),l=n(7),u=n.n(l),i=n(1),s=n.n(i),d=function(e){var t=e.className,n=e.children,r=e.disabled,o=e.onClick;return c.a.createElement("button",{className:s()("Button",t),disabled:r,onClick:o},n)},f=function(e){var t=e.onAdd,n=e.onRemove,r=e.onClear,o=e.canRemove;return c.a.createElement("div",{className:"ControlPanel"},c.a.createElement(d,{className:"ControlPanel__button",onClick:t},"Add"),c.a.createElement(d,{className:"ControlPanel__button",onClick:n,disabled:!o},"Remove"),c.a.createElement(d,{className:"ControlPanel__button",onClick:r},"Clear"))},b=500,E=500,y=500/(b+0),m=500/(E+0),p=function(e){var t=e.edge,n=e.startNode,r=e.endNode,o=e.selected,l=e.onClick,u=Object(a.useMemo)((function(){return function(e,t){var n=t.x-e.x,r=t.y-e.y,o=Math.sqrt(n*n+r*r);return{x:n/=o,y:r/=o}}(n,r)}),[n,r]),i=Object(a.useCallback)((function(e){e.stopPropagation(),l(t,e)}),[t,l]);return c.a.createElement(c.a.Fragment,null,c.a.createElement("line",{className:s()("EdgeView",{"EdgeView--selected":o}),x1:n.x+36*u.x,y1:n.y+36*u.y,x2:r.x-36*u.x,y2:r.y-36*u.y,markerEnd:"url(#arrow)",onClick:i}))};var v,O=function(e){var t=e.node,n=e.selected,r=e.onClick,l=e.onDoubleClick,u=e.onMouseDown,i=e.onMouseMove,d=e.onMouseUp,f=Object(a.useState)(null),b=Object(o.a)(f,2),E=b[0],y=b[1],m=Object(a.useCallback)((function(e){var n={x:e.clientX,y:e.clientY};y(n),u({node:t,start:n,current:n},e)}),[u,t]),p=Object(a.useCallback)((function(e){if(null!==E){var n={x:e.clientX,y:e.clientY},r={node:t,start:E,current:n};y(null),d(r)}}),[d,t,E]),v=Object(a.useCallback)((function(e){if(null!==E){var n={x:e.clientX,y:e.clientY};i({node:t,start:E,current:n})}}),[i,t,E]);Object(a.useEffect)((function(){return document.body.addEventListener("mouseup",p),function(){document.body.removeEventListener("mouseup",p)}}),[p]),Object(a.useEffect)((function(){if(null!==E)return document.body.addEventListener("mousemove",v),function(){document.body.removeEventListener("mousemove",v)}}),[v,E]);var O=Object(a.useCallback)((function(e){e.stopPropagation(),r(t,e)}),[r,t]),D=Object(a.useCallback)((function(e){e.stopPropagation(),l(t,e)}),[l,t]);return c.a.createElement(c.a.Fragment,null,c.a.createElement("circle",{className:s()("NodeView",{"NodeView--selected":n,dragging:E}),cx:t.x,cy:t.y,r:36,onClick:O,onDoubleClick:D,onMouseDown:m}),c.a.createElement(x,{x:t.x,y:t.y,text:t.text}))},x=function(e){var t=e.x,n=e.y,r=e.text;return c.a.createElement("foreignObject",{className:"NodeView__text",x:t-36,y:n-36,width:72,height:72},c.a.createElement("p",{className:"NodeView__text-inner"},r))},D=function(e){var t=e.children;return c.a.createElement("svg",{className:"Stage",width:500,height:500,viewBox:"".concat(-0," ").concat(-0," ").concat(b+0," ").concat(E+0)},c.a.createElement("defs",null,C,j),t)},C=c.a.createElement("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse"},c.a.createElement("path",{d:"M 0 0 L 10 5 L 0 10 z"})),j=c.a.createElement("marker",{id:"dot",viewBox:"0 0 10 10",refX:"5",refY:"5",markerWidth:"5",markerHeight:"5"},c.a.createElement("circle",{cx:"5",cy:"5",r:"5",fill:"red"}));!function(e){e[e.GRAPH_CLEAR=0]="GRAPH_CLEAR",e[e.NODE_ADD=1]="NODE_ADD",e[e.GRAPH_REMOVE=2]="GRAPH_REMOVE",e[e.NODE_UPDATE=3]="NODE_UPDATE",e[e.GRAPH_SELECT=4]="GRAPH_SELECT",e[e.GRAPH_DESELECT=5]="GRAPH_DESELECT",e[e.EDGE_ADD=6]="EDGE_ADD"}(v||(v={}));var g=n(5),h=n(8);function k(){return Object(h.generate)()}function P(e){return Math.floor(Math.random()*e)}function _(e){var t=function e(t,n){if(0===n.length)return t;var r=t.w/2;var o=t.h/2;var a=t.x+r;var c=t.y+o;var l={box:{x:t.x,y:t.y,w:r,h:o},nodes:[]};var u={box:{x:a,y:t.y,w:r,h:o},nodes:[]};var i={box:{x:t.x,y:c,w:r,h:o},nodes:[]};var s={box:{x:a,y:c,w:r,h:o},nodes:[]};for(var d=0;d<n.length;d+=1){var f=n[d];f.x<=a?f.y<=c?l.nodes.push(f):i.nodes.push(f):f.y<=c?u.nodes.push(f):s.nodes.push(f)}var b=(E=[l,u,i,s],E.slice(0).sort((function(e,t){return e.nodes.length-t.nodes.length}))[0]);var E;return function(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}(n,b.nodes)?b.box:e(b.box,b.nodes)}({x:0,y:0,w:b,h:E},e);return{id:k(),x:t.x+t.w/2,y:t.y+t.h/2,text:""}}function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(n,!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R={nodes:function(e){for(var t=[],n=0;n<e;n+=1)t.push(n);return t}(5).map((function(){return{id:k(),x:P(b),y:P(E),text:"sample"}})),edges:[],selectedId:null};function N(e,t){switch(t.type){case v.GRAPH_CLEAR:return A({},e,{nodes:[],edges:[],selectedId:null});case v.GRAPH_REMOVE:var n=e.nodes.filter((function(t){return t.id!==e.selectedId})),r=e.edges.filter((function(t){return t.id!==e.selectedId&&t.start!==e.selectedId&&t.end!==e.selectedId}));return A({},e,{nodes:n,edges:r});case v.GRAPH_SELECT:var o=t.payload.id;return A({},e,{selectedId:o});case v.GRAPH_DESELECT:return A({},e,{selectedId:null});case v.NODE_ADD:var a=_(e.nodes);return A({},e,{nodes:[].concat(Object(g.a)(e.nodes),[a])});case v.NODE_UPDATE:var c=t.payload.node;return A({},e,{nodes:M(e.nodes,c)});case v.EDGE_ADD:var l=t.payload,u=l.start,i=l.end;if(null===u||u===i||!G(e.nodes,u)||!G(e.nodes,i)||(d=e.edges,f=u,b=i,d.find((function(e){return e.start===f&&e.end===b||e.start===b&&e.end===f}))))return e;var s={id:k(),start:u,end:i};return A({},e,{edges:[].concat(Object(g.a)(e.edges),[s])});default:return e}var d,f,b}function M(e,t){return e.map((function(e){return e.id===t.id?t:e}))}function G(e,t){return!!e.find((function(e){return e.id===t}))}function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(n,!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=function(){};var T=document.getElementById("root");u.a.render(c.a.createElement((function(){var e=Object(a.useState)(null),t=Object(o.a)(e,2),n=t[0],r=t[1],l=Object(a.useState)(!1),u=Object(o.a)(l,2),i=u[0],s=u[1],d=Object(a.useReducer)(N,R),b=Object(o.a)(d,2),E=b[0],x=E.nodes,C=E.edges,j=E.selectedId,g=b[1],h=Object(a.useMemo)((function(){return function(e){var t={};return e.forEach((function(e){t[e.id]=e})),t}(x)}),[x]),k=Object(a.useCallback)((function(){g({type:v.GRAPH_CLEAR})}),[]),P=Object(a.useCallback)((function(){g({type:v.NODE_ADD})}),[]),_=Object(a.useCallback)((function(e,t){t.ctrlKey||t.metaKey?g({type:v.EDGE_ADD,payload:{start:j,end:e.id}}):g({type:v.GRAPH_SELECT,payload:{id:e.id}})}),[j]),w=Object(a.useCallback)((function(e){g({type:v.GRAPH_SELECT,payload:{id:e.id}})}),[]),A=Object(a.useCallback)((function(e){var t=prompt("text");if(null!==t){var n=L({},e,{text:t});g({type:v.NODE_UPDATE,payload:{node:n}})}}),[]),M=Object(a.useCallback)((function(){g({type:v.GRAPH_DESELECT})}),[]),G=Object(a.useCallback)((function(){g({type:v.GRAPH_REMOVE})}),[]),H=Object(a.useCallback)((function(e){var t=e.node;r(t)}),[]),T=Object(a.useCallback)((function(e){null!==n&&(g({type:v.NODE_UPDATE,payload:{node:n}}),r(null),s(!1))}),[n]),I=Object(a.useCallback)((function(e){if(null!==n){var t=function(e){var t=e.node,n=e.start,r=e.current,o=(r.x-n.x)/y,a=(r.y-n.y)/m;return L({},t,{x:Math.floor(t.x+o),y:Math.floor(t.y+a)})}(e);o=t,a=e.node,(o.id!==a.id||o.x!==a.x||o.y!==a.y)&&(r(t),s(!0))}var o,a}),[n]);return c.a.createElement("div",{className:"App",onClick:M},c.a.createElement(f,{onAdd:P,onRemove:G,onClear:k,canRemove:null!==j}),c.a.createElement(D,null,C.map((function(e){return c.a.createElement(p,{key:e.id,edge:e,startNode:h[e.start],endNode:h[e.end],selected:j===e.id,onClick:w})})),x.map((function(e){return c.a.createElement(O,{key:e.id,node:e,selected:j===e.id,onClick:_,onDoubleClick:A,onMouseDown:H,onMouseUp:T,onMouseMove:I})})),i&&null!==n&&c.a.createElement(O,{key:n.id,node:n,selected:!1,onClick:S,onDoubleClick:S,onMouseDown:S,onMouseUp:S,onMouseMove:S})))}),null),T)},9:function(e,t,n){e.exports=n(24)}},[[9,1,2]]]);
//# sourceMappingURL=main.0319a1f5.chunk.js.map