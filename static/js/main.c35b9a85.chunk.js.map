{"version":3,"sources":["constants.ts","calculation/Storage.ts","components/Button.tsx","components/ControlPanel.tsx","components/EdgeView.tsx","components/NodeView.tsx","calculation/Keyboard.ts","redux/actions.tsx","components/Stage.tsx","hooks/useGlobalKeyboardShortcut.ts","hooks/useGlobalKeyboard.ts","calculation/generateId.ts","calculation/generateN.ts","calculation/Calculation.ts","redux/reducer.tsx","app.tsx"],"names":["LOGICAL_WIDTH","LOGICAL_HEIGHT","SCALE_X","SCALE_Y","STORAGE_STATE_VERSION","STORAGE_STATE_KEY","save","state","serializedState","data","version","JSON","stringify","serialize","localStorage","setItem","load","serializedData","deserializedData","parse","error","deserialize","getItem","Button","className","children","disabled","onClick","classNames","ControlPanel","onAdd","onRemove","onClear","onRandomize","onSave","canRemove","EdgeView","edge","startNode","endNode","selected","p","useMemo","dx","x","dy","y","ln","Math","sqrt","calculateDirection","handleClick","useCallback","event","stopPropagation","x1","y1","x2","y2","markerEnd","KeyCode","ActionType","NodeView","node","onDoubleClick","onMouseDown","onMouseMove","onMouseUp","useState","startPoint","setStartPoint","handleMouseDown","point","clientX","clientY","start","current","handleMouseUp","payload","handleMouseMove","useEffect","document","body","addEventListener","removeEventListener","handleDoubleClick","dragging","cx","cy","r","text","Text","width","NODE_RADIUS","height","Stage","viewBox","arrowMarker","dotMarker","id","refX","refY","markerWidth","markerHeight","orient","d","fill","useGlobalKeyboardShortcut","dispatch","onKeyDown","element","handleKeyDown","target","useGlobalKeyboard","code","KEY_A","type","NODE_ADD","BACKSPACE","GRAPH_REMOVE","ESCAPE","GRAPH_DESELECT","ctrlKey","metaKey","KEY_S","generateId","generate","generateN","n","floor","random","generateNodes","result","i","push","repeat","map","guessNode","nodes","box","calculateAvailableBox","length","w2","w","h2","h","lt","rt","lb","rb","min","xs","slice","sort","ys","every","isSame","initialState","edges","selectedId","reducer","action","APP_LOAD","APP_RANDOMIZE","GRAPH_CLEAR","newNodes","filter","newEdges","end","GRAPH_SELECT","newNode","NODE_UPDATE","updateNode","EDGE_ADD","hasNodeById","nodeId1","nodeId2","find","newEdge","noop","rootElement","getElementById","ReactDOM","render","draggingNode","setDraggingNode","setDragging","useReducer","nodesById","values","forEach","value","createLookupTable","handleClear","handleAdd","handleClickNode","handleClickEdge","newText","prompt","handleDeselect","handleRemove","_","calculateDraggingNode","a","b","handleSave","handleRandomize","loadedState","key"],"mappings":"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","file":"static/js/main.c35b9a85.chunk.js","sourcesContent":["export const VISUAL_WIDTH = 500;\nexport const VISUAL_HEIGHT = 500;\nexport const LOGICAL_WIDTH = 500;\nexport const LOGICAL_HEIGHT = 500;\nexport const LOGICAL_MARGIN = 0;\nexport const SCALE_X = VISUAL_WIDTH / (LOGICAL_WIDTH + 2 * LOGICAL_MARGIN);\nexport const SCALE_Y = VISUAL_HEIGHT / (LOGICAL_HEIGHT + 2 * LOGICAL_MARGIN);\nexport const NODE_RADIUS = 36;\n\nexport const STORAGE_STATE_VERSION = 1;\nexport const STORAGE_STATE_KEY = 'state';\n","import { STORAGE_STATE_KEY, STORAGE_STATE_VERSION } from '../constants';\nimport { State } from './State';\n\ninterface Data {\n  version: number;\n  data: State;\n}\n\nexport function save(state: State): void {\n  const serializedState = serialize(state);\n  localStorage.setItem(STORAGE_STATE_KEY, serializedState);\n}\n\nexport function load(): State | null {\n  const serializedData = localStorage.getItem(STORAGE_STATE_KEY);\n  return deserialize(serializedData);\n}\n\nfunction serialize(state: State): string {\n  const data: Data = { version: STORAGE_STATE_VERSION, data: state };\n  return JSON.stringify(data);\n}\n\nfunction deserialize(serializedData: string | null): State | null {\n  try {\n    if (serializedData === null) {\n      return null;\n    }\n\n    const deserializedData = JSON.parse(serializedData);\n    if (!validate(deserializedData)) {\n      return null;\n    }\n\n    return deserializedData.data;\n  } catch (error) {\n    return null;\n  }\n}\n\nfunction validate(data: any): data is Data {\n  return data != null && typeof data === 'object' && data.version === STORAGE_STATE_VERSION;\n}\n","import classNames from 'classnames';\nimport React from 'react';\n\ninterface Props {\n  className?: string;\n  disabled?: boolean;\n  onClick: (event: React.MouseEvent) => void;\n}\n\nexport const Button: React.FunctionComponent<Props> = ({\n  className,\n  children,\n  disabled,\n  onClick,\n}) => {\n  return (\n    <button className={classNames('Button', className)} disabled={disabled} onClick={onClick}>\n      {children}\n    </button>\n  );\n};\n","import React from 'react';\nimport { Button } from './Button';\n\nexport const ControlPanel: React.FunctionComponent<{\n  onAdd: () => void;\n  onRemove: () => void;\n  onClear: () => void;\n  onSave: () => void;\n  onRandomize: () => void;\n  canRemove: boolean;\n}> = ({ onAdd, onRemove, onClear, onRandomize, onSave, canRemove }) => {\n  return (\n    <div className=\"ControlPanel\">\n      <Button className=\"ControlPanel__button\" onClick={onAdd}>\n        Add (A)\n      </Button>\n      <Button className=\"ControlPanel__button\" onClick={onRemove} disabled={!canRemove}>\n        Remove (Del)\n      </Button>\n      <Button className=\"ControlPanel__button\" onClick={onClear}>\n        Clear\n      </Button>\n      <Button className=\"ControlPanel__button\" onClick={onRandomize}>\n        Randomize\n      </Button>\n      <Button className=\"ControlPanel__button\" onClick={onSave}>\n        Save (Cmd+S)\n      </Button>\n    </div>\n  );\n};\n","import classNames from 'classnames';\nimport React, { useCallback, useMemo } from 'react';\nimport { Edge } from '../calculation/Edge';\nimport { Node } from '../calculation/Node';\nimport { Point } from '../calculation/Point';\nimport { NODE_RADIUS } from '../constants';\n\ninterface Props {\n  edge: Edge;\n  startNode: Node;\n  endNode: Node;\n  selected: boolean;\n  onClick: (edge: Edge, event: React.MouseEvent) => void;\n}\n\nexport const EdgeView: React.FunctionComponent<Props> = ({\n  edge,\n  startNode,\n  endNode,\n  selected,\n  onClick,\n}) => {\n  const p = useMemo(() => calculateDirection(startNode, endNode), [startNode, endNode]);\n\n  const handleClick = useCallback(\n    (event: React.MouseEvent) => {\n      event.stopPropagation();\n      onClick(edge, event);\n    },\n    [edge, onClick],\n  );\n\n  return (\n    <>\n      <line\n        className={classNames('EdgeView', { 'EdgeView--selected': selected })}\n        x1={startNode.x + p.x * NODE_RADIUS}\n        y1={startNode.y + p.y * NODE_RADIUS}\n        x2={endNode.x - p.x * NODE_RADIUS}\n        y2={endNode.y - p.y * NODE_RADIUS}\n        markerEnd=\"url(#arrow)\"\n        onClick={handleClick}\n      />\n    </>\n  );\n};\n\nfunction calculateDirection(startNode: Node, endNode: Node): Point {\n  let dx = endNode.x - startNode.x;\n  let dy = endNode.y - startNode.y;\n  const ln = Math.sqrt(dx * dx + dy * dy);\n  dx /= ln;\n  dy /= ln;\n  return { x: dx, y: dy };\n}\n","import classNames from 'classnames';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { DragPayload } from '../calculation/DragPayload';\nimport { Node } from '../calculation/Node';\nimport { Point } from '../calculation/Point';\nimport { NODE_RADIUS } from '../constants';\n\ninterface Props {\n  node: Node;\n  selected: boolean;\n  onClick: (node: Node, event: React.MouseEvent) => void;\n  onDoubleClick: (node: Node, event: React.MouseEvent) => void;\n  onMouseDown: (payload: DragPayload, event: React.MouseEvent) => void;\n  onMouseUp: (payload: DragPayload) => void;\n  onMouseMove: (payload: DragPayload) => void;\n}\n\nexport const NodeView: React.FunctionComponent<Props> = ({\n  node,\n  selected,\n  onClick,\n  onDoubleClick,\n  onMouseDown,\n  onMouseMove,\n  onMouseUp,\n}) => {\n  const [startPoint, setStartPoint] = useState<Point | null>(null);\n\n  const handleMouseDown = useCallback(\n    (event: React.MouseEvent) => {\n      const point = { x: event.clientX, y: event.clientY };\n      setStartPoint(point);\n      const payload = { node, start: point, current: point };\n      onMouseDown(payload, event);\n    },\n    [onMouseDown, node],\n  );\n\n  const handleMouseUp = useCallback(\n    (event: MouseEvent) => {\n      if (startPoint !== null) {\n        const point = { x: event.clientX, y: event.clientY };\n        const payload = { node, start: startPoint, current: point };\n        setStartPoint(null);\n        onMouseUp(payload);\n      }\n    },\n    [onMouseUp, node, startPoint],\n  );\n\n  const handleMouseMove = useCallback(\n    (event: MouseEvent) => {\n      if (startPoint !== null) {\n        const point = { x: event.clientX, y: event.clientY };\n        const payload = { node, start: startPoint, current: point };\n        onMouseMove(payload);\n      }\n    },\n    [onMouseMove, node, startPoint],\n  );\n\n  useEffect(() => {\n    document.body.addEventListener('mouseup', handleMouseUp);\n    return () => {\n      document.body.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [handleMouseUp]);\n\n  useEffect(() => {\n    if (startPoint === null) {\n      return;\n    }\n\n    document.body.addEventListener('mousemove', handleMouseMove);\n    return () => {\n      document.body.removeEventListener('mousemove', handleMouseMove);\n    };\n  }, [handleMouseMove, startPoint]);\n\n  const handleClick = useCallback(\n    (event: React.MouseEvent) => {\n      event.stopPropagation();\n      onClick(node, event);\n    },\n    [onClick, node],\n  );\n\n  const handleDoubleClick = useCallback(\n    (event: React.MouseEvent) => {\n      event.stopPropagation();\n      onDoubleClick(node, event);\n    },\n    [onDoubleClick, node],\n  );\n\n  return (\n    <>\n      <circle\n        className={classNames('NodeView', { 'NodeView--selected': selected, dragging: startPoint })}\n        cx={node.x}\n        cy={node.y}\n        r={NODE_RADIUS}\n        onClick={handleClick}\n        onDoubleClick={handleDoubleClick}\n        onMouseDown={handleMouseDown}\n      />\n      <Text x={node.x} y={node.y} text={node.text} />\n    </>\n  );\n};\n\n/**\n * HACK\n * @see https://stackoverflow.com/questions/4991171/auto-line-wrapping-in-svg-text\n */\nconst Text: React.FunctionComponent<{ x: number; y: number; text: string }> = ({ x, y, text }) => {\n  return (\n    <foreignObject\n      className=\"NodeView__text\"\n      x={x - NODE_RADIUS}\n      y={y - NODE_RADIUS}\n      width={NODE_RADIUS * 2}\n      height={NODE_RADIUS * 2}\n    >\n      <p className=\"NodeView__text-inner\">{text}</p>\n    </foreignObject>\n  );\n\n  // return (\n  //   <text className=\"NodeView__text\" textAnchor=\"middle\" dominantBaseline=\"central\" x={x} y={y}>\n  //     {text}\n  //   </text>\n  // );\n};\n","export enum KeyCode {\n  BACKSPACE = 'Backspace',\n  ENTER = 'Enter',\n  ESCAPE = 'Escape',\n  KEY_A = 'KeyA',\n  KEY_D = 'KeyD',\n  KEY_R = 'KeyR',\n  KEY_S = 'KeyS',\n  KEY_W = 'KeyW',\n}\n","import { Node } from '../calculation/Node';\nimport { State } from '../calculation/State';\n\nexport enum ActionType {\n  APP_LOAD,\n  APP_RANDOMIZE,\n  GRAPH_CLEAR,\n  NODE_ADD,\n  GRAPH_REMOVE,\n  NODE_UPDATE,\n  GRAPH_SELECT,\n  GRAPH_DESELECT,\n  EDGE_ADD,\n}\n\nexport type Action =\n  | {\n      type: ActionType.APP_LOAD;\n      payload: { state: State };\n    }\n  | {\n      type: ActionType.APP_RANDOMIZE;\n    }\n  | {\n      type: ActionType.GRAPH_CLEAR;\n    }\n  | {\n      type: ActionType.NODE_ADD;\n    }\n  | {\n      type: ActionType.GRAPH_REMOVE;\n    }\n  | {\n      type: ActionType.NODE_UPDATE;\n      payload: {\n        node: Node;\n      };\n    }\n  | {\n      type: ActionType.GRAPH_SELECT;\n      payload: {\n        id: string;\n      };\n    }\n  | {\n      type: ActionType.GRAPH_DESELECT;\n    }\n  | {\n      type: ActionType.EDGE_ADD;\n      payload: {\n        start: string | null;\n        end: string;\n      };\n    };\n","import React from 'react';\nimport {\n  LOGICAL_HEIGHT,\n  LOGICAL_MARGIN,\n  LOGICAL_WIDTH,\n  VISUAL_HEIGHT,\n  VISUAL_WIDTH,\n} from '../constants';\n\nexport const Stage: React.FunctionComponent<{}> = ({ children }) => {\n  return (\n    <svg\n      className=\"Stage\"\n      width={VISUAL_WIDTH}\n      height={VISUAL_HEIGHT}\n      viewBox={`${-LOGICAL_MARGIN} ${-LOGICAL_MARGIN} ${LOGICAL_WIDTH +\n        LOGICAL_MARGIN} ${LOGICAL_HEIGHT + LOGICAL_MARGIN}`}\n    >\n      <defs>\n        {arrowMarker}\n        {dotMarker}\n      </defs>\n      {children}\n    </svg>\n  );\n};\n\n/**\n * Arrow marker\n * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Element/marker\n */\nconst arrowMarker = (\n  <marker\n    id=\"arrow\"\n    viewBox=\"0 0 10 10\"\n    refX=\"5\"\n    refY=\"5\"\n    markerWidth=\"6\"\n    markerHeight=\"6\"\n    orient=\"auto-start-reverse\"\n  >\n    <path d=\"M 0 0 L 10 5 L 0 10 z\" />\n  </marker>\n);\n\n/**\n * Dot marker\n * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Element/marker\n */\nconst dotMarker = (\n  <marker id=\"dot\" viewBox=\"0 0 10 10\" refX=\"5\" refY=\"5\" markerWidth=\"5\" markerHeight=\"5\">\n    <circle cx=\"5\" cy=\"5\" r=\"5\" fill=\"red\" />\n  </marker>\n);\n","import { Dispatch, useCallback } from 'react';\nimport { KeyCode } from '../calculation/Keyboard';\nimport { Action, ActionType } from '../redux/actions';\nimport { useGlobalKeyboard } from './useGlobalKeyboard';\n\ninterface Options {\n  dispatch: Dispatch<Action>;\n  onSave: () => void;\n}\n\nexport function useGlobalKeyboardShortcut({ dispatch, onSave }: Options) {\n  const onKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.code === KeyCode.KEY_A) {\n        dispatch({ type: ActionType.NODE_ADD });\n      } else if (event.code === KeyCode.BACKSPACE) {\n        dispatch({ type: ActionType.GRAPH_REMOVE });\n      } else if (event.code === KeyCode.ESCAPE) {\n        dispatch({ type: ActionType.GRAPH_DESELECT });\n      } else if ((event.ctrlKey || event.metaKey) && event.code === KeyCode.KEY_S) {\n        onSave();\n      }\n    },\n    [dispatch],\n  );\n\n  useGlobalKeyboard({ onKeyDown });\n}\n","import { useEffect } from 'react';\n\ninterface Options {\n  onKeyDown: (event: KeyboardEvent) => void;\n}\n\nexport function useGlobalKeyboard({ onKeyDown }: Options): void {\n  useEffect(() => {\n    const element = document.body;\n\n    function handleKeyDown(event: KeyboardEvent): void {\n      // Call onKeyDown only when no elements are focused\n      if (event.target === element) {\n        onKeyDown(event);\n      }\n    }\n\n    element.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      element.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [onKeyDown]);\n}\n","import { generate } from 'shortid';\n\nexport function generateId(): string {\n  return generate();\n}\n","export function generateN(n: number): number {\n  return Math.floor(Math.random() * n);\n}\n","import { LOGICAL_HEIGHT, LOGICAL_WIDTH } from '../constants';\nimport { generateId } from './generateId';\nimport { generateN } from './generateN';\nimport { Node } from './Node';\n\ninterface Box {\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n}\n\ninterface Result {\n  box: Box;\n  nodes: Node[];\n}\n\nfunction repeat(n: number): number[] {\n  const result: number[] = [];\n  for (let i = 0; i < n; i += 1) {\n    result.push(i);\n  }\n  return result;\n}\n\nfunction generateNode(): Node {\n  const id = generateId();\n  const x = generateN(LOGICAL_WIDTH);\n  const y = generateN(LOGICAL_HEIGHT);\n  return { id, x, y, text: 'sample' };\n}\n\nexport function generateNodes(): Node[] {\n  return repeat(5).map(() => generateNode());\n}\n\nexport function guessNode(nodes: Node[]): Node {\n  const box0 = { x: 0, y: 0, w: LOGICAL_WIDTH, h: LOGICAL_HEIGHT };\n  const box = calculateAvailableBox(box0, nodes);\n  const id = generateId();\n  const x = box.x + box.w / 2;\n  const y = box.y + box.h / 2;\n  return { id, x, y, text: '' };\n}\n\nfunction calculateAvailableBox(box: Box, nodes: Node[]): Box {\n  if (nodes.length === 0) {\n    return box;\n  }\n\n  const w2 = box.w / 2;\n  const h2 = box.h / 2;\n  const cx = box.x + w2;\n  const cy = box.y + h2;\n  const lt: Result = { box: { x: box.x, y: box.y, w: w2, h: h2 }, nodes: [] };\n  const rt: Result = { box: { x: cx, y: box.y, w: w2, h: h2 }, nodes: [] };\n  const lb: Result = { box: { x: box.x, y: cy, w: w2, h: h2 }, nodes: [] };\n  const rb: Result = { box: { x: cx, y: cy, w: w2, h: h2 }, nodes: [] };\n\n  for (let i = 0; i < nodes.length; i += 1) {\n    const node = nodes[i];\n    if (node.x <= cx) {\n      if (node.y <= cy) {\n        lt.nodes.push(node);\n      } else {\n        lb.nodes.push(node);\n      }\n    } else {\n      if (node.y <= cy) {\n        rt.nodes.push(node);\n      } else {\n        rb.nodes.push(node);\n      }\n    }\n  }\n\n  const min = sortByLength([lt, rt, lb, rb]);\n  return isSame(nodes, min.nodes) ? min.box : calculateAvailableBox(min.box, min.nodes);\n}\n\nfunction isSame(xs: Node[], ys: Node[]): boolean {\n  return xs.length === ys.length && xs.every((x, i) => x === ys[i]);\n}\n\nfunction sortByLength(xs: Result[]): Result {\n  return xs.slice(0).sort((x, y) => x.nodes.length - y.nodes.length)[0];\n}\n","import { generateNodes, guessNode } from '../calculation/Calculation';\nimport { Edge } from '../calculation/Edge';\nimport { generateId } from '../calculation/generateId';\nimport { Node } from '../calculation/Node';\nimport { State } from '../calculation/State';\nimport { Action, ActionType } from './actions';\n\nexport const initialState: State = {\n  nodes: [],\n  edges: [],\n  selectedId: null,\n};\n\nexport function reducer(state: State, action: Action): State {\n  switch (action.type) {\n    case ActionType.APP_LOAD: {\n      return action.payload.state;\n    }\n    case ActionType.APP_RANDOMIZE: {\n      const newState: State = {\n        nodes: generateNodes(),\n        edges: [],\n        selectedId: null,\n      };\n      return newState;\n    }\n    case ActionType.GRAPH_CLEAR: {\n      return { ...state, nodes: [], edges: [], selectedId: null };\n    }\n    case ActionType.GRAPH_REMOVE: {\n      const newNodes = state.nodes.filter(node => node.id !== state.selectedId);\n      const newEdges = state.edges.filter(\n        edge =>\n          edge.id !== state.selectedId &&\n          edge.start !== state.selectedId &&\n          edge.end !== state.selectedId,\n      );\n      return { ...state, nodes: newNodes, edges: newEdges };\n    }\n    case ActionType.GRAPH_SELECT: {\n      const { id } = action.payload;\n      return { ...state, selectedId: id };\n    }\n    case ActionType.GRAPH_DESELECT: {\n      return { ...state, selectedId: null };\n    }\n    case ActionType.NODE_ADD: {\n      const newNode = guessNode(state.nodes);\n      return {\n        ...state,\n        nodes: [...state.nodes, newNode],\n      };\n    }\n    case ActionType.NODE_UPDATE: {\n      const { node } = action.payload;\n      return { ...state, nodes: updateNode(state.nodes, node) };\n    }\n    case ActionType.EDGE_ADD: {\n      const { start, end } = action.payload;\n      if (\n        start === null ||\n        start === end ||\n        !hasNodeById(state.nodes, start) ||\n        !hasNodeById(state.nodes, end) ||\n        hasEdgeByNodeIds(state.edges, start, end)\n      ) {\n        return state;\n      }\n      const newEdge = { id: generateId(), start, end };\n      return {\n        ...state,\n        edges: [...state.edges, newEdge],\n      };\n    }\n    default:\n      return state;\n  }\n}\n\nfunction updateNode(nodes: Node[], newNode: Node): Node[] {\n  return nodes.map(node => (node.id === newNode.id ? newNode : node));\n}\n\nfunction hasNodeById(nodes: Node[], id: string): boolean {\n  return !!nodes.find(node => node.id === id);\n}\n\nfunction hasEdgeByNodeIds(edges: Edge[], nodeId1: string, nodeId2: string): boolean {\n  return !!edges.find(\n    edge =>\n      (edge.start === nodeId1 && edge.end === nodeId2) ||\n      (edge.start === nodeId2 && edge.end === nodeId1),\n  );\n}\n","import React, { useCallback, useEffect, useMemo, useReducer, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { DragPayload } from './calculation/DragPayload';\nimport { Edge } from './calculation/Edge';\nimport { Node } from './calculation/Node';\nimport { load, save } from './calculation/Storage';\nimport { ControlPanel } from './components/ControlPanel';\nimport { EdgeView } from './components/EdgeView';\nimport { NodeView } from './components/NodeView';\nimport { Stage } from './components/Stage';\nimport { SCALE_X, SCALE_Y } from './constants';\nimport { useGlobalKeyboardShortcut } from './hooks/useGlobalKeyboardShortcut';\nimport { ActionType } from './redux/actions';\nimport { initialState, reducer } from './redux/reducer';\n\nconst noop = () => {};\n\nconst App: React.FunctionComponent<{}> = () => {\n  const [draggingNode, setDraggingNode] = useState<Node | null>(null);\n  const [dragging, setDragging] = useState(false);\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const { nodes, edges, selectedId } = state;\n  const nodesById = useMemo(() => createLookupTable(nodes), [nodes]);\n\n  const handleClear = useCallback(() => {\n    dispatch({ type: ActionType.GRAPH_CLEAR });\n  }, []);\n\n  const handleAdd = useCallback(() => {\n    dispatch({ type: ActionType.NODE_ADD });\n  }, []);\n\n  const handleClickNode = useCallback(\n    (node: Node, event: React.MouseEvent) => {\n      if (event.ctrlKey || event.metaKey) {\n        dispatch({ type: ActionType.EDGE_ADD, payload: { start: selectedId, end: node.id } });\n      } else {\n        dispatch({ type: ActionType.GRAPH_SELECT, payload: { id: node.id } });\n      }\n    },\n    [selectedId],\n  );\n\n  const handleClickEdge = useCallback((edge: Edge) => {\n    dispatch({ type: ActionType.GRAPH_SELECT, payload: { id: edge.id } });\n  }, []);\n\n  const handleDoubleClick = useCallback((node: Node) => {\n    const newText = prompt('text');\n    if (newText !== null) {\n      const newNode = { ...node, text: newText };\n      dispatch({ type: ActionType.NODE_UPDATE, payload: { node: newNode } });\n    }\n  }, []);\n\n  const handleDeselect = useCallback(() => {\n    dispatch({ type: ActionType.GRAPH_DESELECT });\n  }, []);\n\n  const handleRemove = useCallback(() => {\n    dispatch({ type: ActionType.GRAPH_REMOVE });\n  }, []);\n\n  const handleMouseDown = useCallback(({ node }: DragPayload) => {\n    setDraggingNode(node);\n  }, []);\n\n  const handleMouseUp = useCallback(\n    (_: DragPayload) => {\n      if (draggingNode !== null) {\n        dispatch({ type: ActionType.NODE_UPDATE, payload: { node: draggingNode } });\n        setDraggingNode(null);\n        setDragging(false);\n      }\n    },\n    [draggingNode],\n  );\n\n  const handleMouseMove = useCallback(\n    (payload: DragPayload) => {\n      if (draggingNode !== null) {\n        const node = calculateDraggingNode(payload);\n        if (!isEqual(node, payload.node)) {\n          setDraggingNode(node);\n          setDragging(true);\n        }\n      }\n    },\n    [draggingNode],\n  );\n\n  const handleSave = useCallback(() => {\n    save(state);\n  }, [state]);\n\n  const handleRandomize = useCallback(() => {\n    dispatch({ type: ActionType.APP_RANDOMIZE });\n  }, []);\n\n  useEffect(() => {\n    const loadedState = load();\n    if (loadedState !== null) {\n      dispatch({ type: ActionType.APP_LOAD, payload: { state: loadedState } });\n    }\n  }, []);\n\n  useGlobalKeyboardShortcut({\n    dispatch,\n    onSave: handleSave,\n  });\n\n  return (\n    <div className=\"App\" onClick={handleDeselect}>\n      <ControlPanel\n        onAdd={handleAdd}\n        onRemove={handleRemove}\n        onClear={handleClear}\n        onRandomize={handleRandomize}\n        onSave={handleSave}\n        canRemove={selectedId !== null}\n      />\n      <Stage>\n        {edges.map(edge => (\n          <EdgeView\n            key={edge.id}\n            edge={edge}\n            startNode={nodesById[edge.start]}\n            endNode={nodesById[edge.end]}\n            selected={selectedId === edge.id}\n            onClick={handleClickEdge}\n          />\n        ))}\n        {nodes.map(node => (\n          <NodeView\n            key={node.id}\n            node={node}\n            selected={selectedId === node.id}\n            onClick={handleClickNode}\n            onDoubleClick={handleDoubleClick}\n            onMouseDown={handleMouseDown}\n            onMouseUp={handleMouseUp}\n            onMouseMove={handleMouseMove}\n          />\n        ))}\n        {dragging && draggingNode !== null && (\n          <NodeView\n            key={draggingNode.id}\n            node={draggingNode}\n            selected={false}\n            onClick={noop}\n            onDoubleClick={noop}\n            onMouseDown={noop}\n            onMouseUp={noop}\n            onMouseMove={noop}\n          />\n        )}\n      </Stage>\n    </div>\n  );\n};\n\nfunction createLookupTable<T extends { id: string }>(values: T[]): Record<string, T> {\n  const result: Record<string, T> = {};\n  values.forEach(value => {\n    result[value.id] = value;\n  });\n  return result;\n}\n\nfunction calculateDraggingNode({ node, start, current }: DragPayload): Node {\n  const dx = (current.x - start.x) / SCALE_X;\n  const dy = (current.y - start.y) / SCALE_Y;\n  return { ...node, x: Math.floor(node.x + dx), y: Math.floor(node.y + dy) };\n}\n\nfunction isEqual(a: Node, b: Node): boolean {\n  return a.id === b.id && a.x === b.x && a.y === b.y;\n}\n\nconst rootElement = document.getElementById('root');\nReactDOM.render(<App />, rootElement);\n"],"sourceRoot":""}